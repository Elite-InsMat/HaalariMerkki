#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <stdlib.h>
#include <time.h>
#include "globals.hpp"
#include "mikabounce.hpp"

static const uint8_t mika_smile[] = {
  0x00, 0x03, 0xf0, 0x00, 
  0x00, 0x3f, 0xec, 0x00, 
  0x00, 0x7f, 0xf6, 0x00, 
  0x00, 0xff, 0xfa, 0x00, 
  0x01, 0xfd, 0xd5, 0x00, 
  0x01, 0xfd, 0x76, 0x80, 
  0x07, 0xf7, 0x5a, 0x80, 
  0x03, 0xe9, 0xab, 0x40, 
  0x0f, 0x55, 0x55, 0x40, 
  0x07, 0x55, 0x55, 0xa0, 
  0x0d, 0x54, 0xaa, 0xa0, 
  0x16, 0xaa, 0xaa, 0xa0, 
  0x1a, 0xaa, 0xab, 0x50, 
  0x0e, 0xaa, 0x55, 0x50, 
  0x1a, 0xaa, 0xaa, 0xa0, 
  0x1a, 0xaa, 0xaa, 0xa8, 
  0x2d, 0x55, 0x4a, 0xb0, 
  0x35, 0x05, 0x42, 0xa8, 
  0x15, 0x0a, 0xa5, 0x50, 
  0x15, 0x55, 0x52, 0xb4, 
  0x2a, 0xaa, 0xaa, 0xa8, 
  0x3a, 0xaa, 0xaa, 0xec, 
  0x55, 0x5a, 0xaa, 0xa8, 
  0x3d, 0x6a, 0xaa, 0xb4, 
  0x7a, 0xb5, 0xb5, 0xa8, 
  0x3f, 0x5a, 0xda, 0xec, 
  0x6a, 0xaa, 0xab, 0x54, 
  0xbb, 0xaa, 0xd5, 0xb4, 
  0x56, 0xad, 0x56, 0xa8, 
  0x6b, 0xea, 0xab, 0x68, 
  0xae, 0xd6, 0xb6, 0xd0, 
  0x56, 0xea, 0xbe, 0xb0, 
  0x5f, 0x7b, 0xf6, 0xd0, 
  0x67, 0xbf, 0xf6, 0xa0, 
  0x1e, 0xbf, 0xad, 0xc0, 
  0x0f, 0xca, 0xad, 0x00, 
  0x02, 0xb5, 0x56, 0x00, 
  0x00, 0xaa, 0xa8, 0x00, 
  0x00, 0x15, 0x00, 0x00, 
};

int incX = 1;
int incY = 1;
int x = 0;
int y = 0;
static int b_counter = 0;

void mikabounce_loop() {
  display.clearDisplay();
  b_counter++;
  if(x>=128-30){incX = rand() % (3-2+2)+2; incX -= incX*2;b_counter++;}
  if(y>=64-39){incY = rand() % (3-2+2)+2; incY -= incY*2;b_counter++;}
  if(x<=0){incX=rand() % (3-2+2)+2;b_counter++;}
  if(y<=0){incY=rand() % (3-2+2)+2;b_counter++;}
  display.drawBitmap(x,y, mika_smile, 30, 39, 1);
  display.display();
  
 x = x+incX;
 y = y+incY;
}